<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycby81ycJHK0S9NUWgWuYSuHHzmz9mf2VKV_oDt4KEJv-hvSvlvOF-dxZa-AnZacewuJ8/exec';

  let teams = [];

  function divisionLabel(code) {
    const map = {
      '10UB': '10U Boys',
      '10UG': '10U Girls',
      '12UB': '12U Boys',
      '12UG': '12U Girls',
      '14UB': '14U Boys',
      '14UG': '14U Girls'
    };
    return map[code] || code || '';
  }

  const approvedBody = document.getElementById('approvedTeamsBody');
  const approvedEmptyNote = document.getElementById('approvedEmptyNote');
  const divisionFiltersContainer = document.getElementById('divisionFilters');
  let approvedFilterDivision = 'ALL';

  divisionFiltersContainer.addEventListener('click', (e) => {
    const btn = e.target.closest('.pill-filter');
    if (!btn) return;
    approvedFilterDivision = btn.dataset.div;
    divisionFiltersContainer.querySelectorAll('.pill-filter').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderApprovedTeams();
  });

  function renderApprovedTeams() {
    approvedBody.innerHTML = '';

    const approvedTeams = teams
      .filter(t => t.status === 'approved')
      .filter(t => approvedFilterDivision === 'ALL' || t.division === approvedFilterDivision)
      .sort((a, b) => {
        if (a.division === b.division) {
          return (a.teamName || '').localeCompare(b.teamName || '');
        }
        return (a.division || '').localeCompare(b.division || '');
      });

    if (approvedTeams.length === 0) {
      approvedEmptyNote.style.display = 'block';
      return;
    } else {
      approvedEmptyNote.style.display = 'none';
    }

    approvedTeams.forEach(team => {
      const tr = document.createElement('tr');

      const tdDiv = document.createElement('td');
      const divTag = document.createElement('span');
      divTag.className = 'tag tag-division';
      divTag.textContent = divisionLabel(team.division);
      tdDiv.appendChild(divTag);

      const tdRegion = document.createElement('td');
      tdRegion.textContent = team.regionNumber || '';

      const tdTeam = document.createElement('td');
      tdTeam.textContent = team.teamName || '';

      const tdCoach = document.createElement('td');
      tdCoach.textContent = team.coachName || '';

      const tdCity = document.createElement('td');
      const city = team.city || '';
      const state = team.state || '';
      tdCity.textContent = city && state ? `${city}, ${state}` : city || state || '';

      tr.appendChild(tdDiv);
      tr.appendChild(tdRegion);
      tr.appendChild(tdTeam);
      tr.appendChild(tdCoach);
      tr.appendChild(tdCity);

      approvedBody.appendChild(tr);
    });
  }

  async function loadTeamsFromApi() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      teams = Array.isArray(data) ? data : [];
      renderApprovedTeams();
    } catch (err) {
      console.error(err);
      approvedEmptyNote.style.display = 'block';
      approvedEmptyNote.textContent = 'Unable to load teams. Please try again later.';
    }
  }

  loadTeamsFromApi();
</script>

